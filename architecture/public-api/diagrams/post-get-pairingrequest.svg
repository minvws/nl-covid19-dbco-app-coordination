<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="904px" preserveAspectRatio="none" style="width:1660px;height:904px;" version="1.1" viewBox="0 0 1660 904" width="1660px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xvbvjb68y6g4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1xvbvjb68y6g4)" height="462.9688" style="stroke:#000000;stroke-width:2.0;" width="1636.5" x="10" y="339.9727"/><rect fill="#FFFFFF" filter="url(#f1xvbvjb68y6g4)" height="402.3477" style="stroke:#000000;stroke-width:2.0;" width="1391" x="245.5" y="393.5938"/><rect fill="#FFFFFF" filter="url(#f1xvbvjb68y6g4)" height="195.1738" style="stroke:#000000;stroke-width:2.0;" width="900" x="255.5" y="593.7676"/><rect fill="#FFFFFF" filter="url(#f1xvbvjb68y6g4)" height="163.8633" style="stroke:#000000;stroke-width:2.0;" width="880" x="265.5" y="618.0781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="56" x2="56" y1="88.4883" y2="819.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="297.5" x2="297.5" y1="88.4883" y2="819.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="503" x2="503" y1="88.4883" y2="819.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="759.5" x2="759.5" y1="88.4883" y2="819.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1094.5" x2="1094.5" y1="88.4883" y2="819.9414"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1584.5" x2="1584.5" y1="88.4883" y2="819.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="20" y="85.5352">Caregiver</text><ellipse cx="56" cy="15" fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M56,23 L56,50 M43,31 L69,31 M56,50 L43,65 M56,50 L69,65 " fill="none" filter="url(#f1xvbvjb68y6g4)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="20" y="832.4766">Caregiver</text><ellipse cx="56" cy="845.4297" fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M56,853.4297 L56,880.4297 M43,861.4297 L69,861.4297 M56,880.4297 L43,895.4297 M56,880.4297 L69,895.4297 " fill="none" filter="url(#f1xvbvjb68y6g4)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="275.5" y="85.5352">Index</text><ellipse cx="298" cy="15" fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M298,23 L298,50 M285,31 L311,31 M298,50 L285,65 M298,50 L311,65 " fill="none" filter="url(#f1xvbvjb68y6g4)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="275.5" y="832.4766">Index</text><ellipse cx="298" cy="845.4297" fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M298,853.4297 L298,880.4297 M285,861.4297 L311,861.4297 M298,880.4297 L285,895.4297 M298,880.4297 L311,895.4297 " fill="none" filter="url(#f1xvbvjb68y6g4)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="42" x="480" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="487" y="73.5352">App</text><rect fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="42" x="480" y="818.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="487" y="839.4766">App</text><rect fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="67" x="724.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="731.5" y="73.5352">Firewall</text><rect fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="67" x="724.5" y="818.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="731.5" y="839.4766">Firewall</text><rect fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="77" x="1054.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="1061.5" y="73.5352">PublicAPI</text><rect fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="77" x="1054.5" y="818.9414"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="1061.5" y="839.4766">PublicAPI</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="1543.5" y="85.5352">SluiceRedis</text><path d="M1567,36 C1567,26 1585,26 1585,26 C1585,26 1603,26 1603,36 L1603,62 C1603,72 1585,72 1585,72 C1585,72 1567,72 1567,62 L1567,36 " fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1567,36 C1567,46 1585,46 1585,46 C1585,46 1603,46 1603,36 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="1543.5" y="832.4766">SluiceRedis</text><path d="M1567,845.4297 C1567,835.4297 1585,835.4297 1585,835.4297 C1585,835.4297 1603,835.4297 1603,845.4297 L1603,871.4297 C1603,881.4297 1585,881.4297 1585,881.4297 C1585,881.4297 1567,881.4297 1567,871.4297 L1567,845.4297 " fill="#FEFECE" filter="url(#f1xvbvjb68y6g4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1567,845.4297 C1567,855.4297 1585,855.4297 1585,855.4297 C1585,855.4297 1603,855.4297 1603,845.4297 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><polygon fill="#A80036" points="286,115.7988,296,119.7988,286,123.7988,290,119.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="56" x2="292" y1="119.7988" y2="119.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="63" y="115.0566">Ask for reverse pairing code</text><polygon fill="#A80036" points="491,145.1094,501,149.1094,491,153.1094,495,149.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="298" x2="497" y1="149.1094" y2="149.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="305" y="144.3672">Request reverse pairing code</text><polygon fill="#A80036" points="748,174.4199,758,178.4199,748,182.4199,752,178.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503" x2="754" y1="178.4199" y2="178.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="510" y="173.6777">POST /v2/pairingrequests</text><polygon fill="#A80036" points="1083,203.7305,1093,207.7305,1083,211.7305,1087,207.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="760" x2="1089" y1="207.7305" y2="207.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="767" y="202.9883">POST /v2/pairingrequests</text><polygon fill="#A80036" points="1573,233.041,1583,237.041,1573,241.041,1577,237.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1095" x2="1579" y1="237.041" y2="237.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="1102" y="232.2988">Store pairing request</text><polygon fill="#A80036" points="771,262.3516,761,266.3516,771,270.3516,767,266.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="765" x2="1094" y1="266.3516" y2="266.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="777" y="261.6094">Pairing request JSON response (code / poll token)</text><polygon fill="#A80036" points="514,291.6621,504,295.6621,514,299.6621,510,295.6621" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="508" x2="759" y1="295.6621" y2="295.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="520" y="290.9199">Pairing JSON response</text><polygon fill="#A80036" points="309,320.9727,299,324.9727,309,328.9727,305,324.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="303" x2="502" y1="324.9727" y2="324.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="315" y="320.2305">Show reverse pairing code</text><path d="M10,339.9727 L78,339.9727 L78,346.9727 L68,356.9727 L10,356.9727 L10,339.9727 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="462.9688" style="stroke:#000000;stroke-width:2.0;" width="1636.5" x="10" y="339.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23" x="25" y="353.541">par</text><polygon fill="#A80036" points="67,374.5938,57,378.5938,67,382.5938,63,378.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="61" x2="297" y1="378.5938" y2="378.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="73" y="373.8516">Communicate reverse pairing code</text><path d="M245.5,393.5938 L319.5,393.5938 L319.5,400.5938 L309.5,410.5938 L245.5,410.5938 L245.5,393.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="402.3477" style="stroke:#000000;stroke-width:2.0;" width="1391" x="245.5" y="393.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="260.5" y="407.1621">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="197" x="334.5" y="406.2285">[Get reverse pairing request status]</text><polygon fill="#A80036" points="748,428.2148,758,432.2148,748,436.2148,752,432.2148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503" x2="754" y1="432.2148" y2="432.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="510" y="427.4727">GET /v2/pairingrequests/{pollToken}</text><polygon fill="#A80036" points="1083,457.5254,1093,461.5254,1083,465.5254,1087,461.5254" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="760" x2="1089" y1="461.5254" y2="461.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="767" y="456.7832">GET /v2/pairingrequests/{pollToken}</text><polygon fill="#A80036" points="1573,486.8359,1583,490.8359,1573,494.8359,1577,490.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1095" x2="1579" y1="490.8359" y2="490.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="1102" y="486.0938">Get pairing request status for poll token</text><polygon fill="#A80036" points="1106,516.1465,1096,520.1465,1106,524.1465,1102,520.1465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1100" x2="1584" y1="520.1465" y2="520.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="466" x="1112" y="515.4043">Pairing request status (status, plus, when confirmed, normal pairing code)</text><polygon fill="#A80036" points="771,545.457,761,549.457,771,553.457,767,549.457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="765" x2="1094" y1="549.457" y2="549.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="777" y="544.7148">Pairing request status JSON response</text><polygon fill="#A80036" points="514,574.7676,504,578.7676,514,582.7676,510,578.7676" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="508" x2="759" y1="578.7676" y2="578.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="520" y="574.0254">Pairing request status JSON response</text><path d="M255.5,593.7676 L339.5,593.7676 L339.5,600.7676 L329.5,610.7676 L255.5,610.7676 L255.5,593.7676 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="195.1738" style="stroke:#000000;stroke-width:2.0;" width="900" x="255.5" y="593.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="270.5" y="607.3359">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="204" x="354.5" y="606.4023">[Reverse pairing request successful]</text><path d="M265.5,618.0781 L333.5,618.0781 L333.5,625.0781 L323.5,635.0781 L265.5,635.0781 L265.5,618.0781 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="163.8633" style="stroke:#000000;stroke-width:2.0;" width="880" x="265.5" y="618.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="280.5" y="631.6465">ref</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="122" x="348.5" y="630.7129">[Normal pairing flow]</text><polygon fill="#A80036" points="748,652.6992,758,656.6992,748,660.6992,752,656.6992" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503" x2="754" y1="656.6992" y2="656.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="510" y="651.957">POST /v2/pairings</text><polygon fill="#A80036" points="1083,682.0098,1093,686.0098,1083,690.0098,1087,686.0098" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="760" x2="1089" y1="686.0098" y2="686.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="767" y="681.2676">... (see normal pairing flow)</text><polygon fill="#A80036" points="771,711.3203,761,715.3203,771,719.3203,767,715.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="765" x2="1094" y1="715.3203" y2="715.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="777" y="710.5781">...</text><polygon fill="#A80036" points="514,740.6309,504,744.6309,514,748.6309,510,744.6309" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="508" x2="759" y1="744.6309" y2="744.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="520" y="739.8887">Pairing JSON response</text><polygon fill="#A80036" points="309,769.9414,299,773.9414,309,777.9414,305,773.9414" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="303" x2="502" y1="773.9414" y2="773.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="315" y="769.1992">Show pairing result</text><!--MD5=[0a699b76d603d32ef304c7da4a4eb0f4]
@startuml
actor       Caregiver   as Caregiver
actor       Index       as Index
participant App         as App
participant Firewall    as Firewall
participant PublicAPI   as API
database    SluiceRedis as Redis

Caregiver  -> Index       : Ask for reverse pairing code
Index      ->  App        : Request reverse pairing code
App        ->  Firewall   : POST /v2/pairingrequests
Firewall   ->  API        : POST /v2/pairingrequests
API        ->  Redis      : Store pairing request
API        - -> Firewall   : Pairing request JSON response (code / poll token)
Firewall   - -> App        : Pairing JSON response
App        ->  Index      : Show reverse pairing code

par
    Index ->  Caregiver : Communicate reverse pairing code

    loop Get reverse pairing request status
        App        ->  Firewall   : GET /v2/pairingrequests/{pollToken}
        Firewall   ->  API        : GET /v2/pairingrequests/{pollToken}
        API        ->  Redis      : Get pairing request status for poll token
        Redis      - -> API        : Pairing request status (status, plus, when confirmed, normal pairing code)
        API        - -> Firewall   : Pairing request status JSON response
        Firewall   - -> App        : Pairing request status JSON response

        break Reverse pairing request successful
            group ref [Normal pairing flow]
                App      ->  Firewall : POST /v2/pairings
                Firewall ->  API      : ... (see normal pairing flow)
                API      - -> Firewall : ...
                Firewall - -> App      : Pairing JSON response
                App      - -> Index    : Show pairing result
            end
        end
    end
end
@enduml

PlantUML version 1.2021.5(Sun Apr 25 13:20:28 CEST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: NL
--></g></svg>